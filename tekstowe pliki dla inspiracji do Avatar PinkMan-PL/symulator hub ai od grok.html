<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub AI - Symulator Meta-Geniusz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050510;
            color: #ffffff;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            gap: 2rem;
            background-image: radial-gradient(circle at 50% 0%, #1a1a2e 0%, #050510 60%);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0d0d1a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4c00ff; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #b400ff; 
        }

        .container {
            position: relative;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 900px;
        }

        .core {
            width: 15rem;
            height: 15rem;
            background: linear-gradient(135deg, #4c00ff, #b400ff);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 40px rgba(180, 0, 255, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            animation: pulse 4s infinite cubic-bezier(0.65, 0.05, 0.36, 1);
            transition: all 0.5s ease-in-out;
            border: 2px solid rgba(255,255,255,0.1);
            z-index: 20;
        }

        .core:hover {
            box-shadow: 0 0 80px rgba(180, 0, 255, 0.8);
            transform: scale(1.02);
        }

        .core.unstable {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite;
            background: linear-gradient(135deg, #ff0000, #ff4d4d);
            box-shadow: 0 0 60px rgba(255, 0, 0, 0.8);
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) scale(1.02); }
            20%, 80% { transform: translate3d(2px, 0, 0) scale(1.02); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0) scale(1.02); }
            40%, 60% { transform: translate3d(4px, 0, 0) scale(1.02); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 40px rgba(180, 0, 255, 0.4); }
            50% { box-shadow: 0 0 80px rgba(180, 0, 255, 0.8), 0 0 100px rgba(76, 0, 255, 0.4); }
            100% { box-shadow: 0 0 40px rgba(180, 0, 255, 0.4); }
        }

        .core-glow {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: absolute;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
            animation: innerGlow 3s infinite ease-in-out;
        }

        /* Obrotowy pierścień */
        .core-ring {
            position: absolute;
            width: 17rem;
            height: 17rem;
            border-radius: 50%;
            border: 1px dashed rgba(180, 0, 255, 0.5);
            animation: spin 20s linear infinite;
            pointer-events: none;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .core-content {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 700;
            color: #ffffff;
            z-index: 30;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .value-box {
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            margin: 0.25rem 0;
            font-size: 0.9rem;
            min-width: 140px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn {
            background: linear-gradient(90deg, #4c00ff, #b400ff);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(180, 0, 255, 0.3);
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn:hover {
            box-shadow: 0 0 20px rgba(180, 0, 255, 0.6);
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-destructive {
            background: linear-gradient(90deg, #8B0000, #ff4d4d);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
        }

        .btn-destructive:hover {
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
        }
        
        .panel-box {
            background-color: #111122;
            border: 1px solid #2e2e4a;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            transition: border-color 0.3s;
        }

        .panel-box:hover {
            border-color: #4c00ff;
        }
        
        .status-box {
            background-color: #1a1a2e;
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
            border: 1px solid #2e2e4a;
        }
        
        .status-box.success { border-left: 4px solid #21a153; }
        .status-box.error { border-left: 4px solid #e53e3e; }
        
        .gok-ai-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, #a066ff, #ffffff, #ff6666);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            letter-spacing: -0.05em;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 30px rgba(160, 102, 255, 0.3);
        }

        /* Range Sliders */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: #2e2e4a;
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #b400ff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(180, 0, 255, 0.5);
            transition: transform 0.1s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .glow-button {
            position: relative;
            background: rgba(0,0,0,0.5);
            border: 2px solid #b400ff;
            padding: 1rem 2.5rem;
            border-radius: 9999px;
            color: #b400ff;
            font-weight: 800;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(180, 0, 255, 0.2);
        }
        
        .glow-button:hover {
            background: #b400ff;
            color: white;
            box-shadow: 0 0 40px rgba(180, 0, 255, 0.6);
        }

        /* Terminal/Console style for outputs */
        .console-output {
            font-family: 'Courier New', monospace;
            background: #0a0a12;
            border: 1px solid #333;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.85rem;
            color: #00ff88;
        }
        .console-line { margin-bottom: 0.25rem; }
        .console-line.error { color: #ff4444; }
        .console-line.system { color: #8888ff; }

        /* Generated Content Preview */
        .generated-content {
            margin-top: 1rem;
            padding: 1rem;
            background: #151525;
            border-radius: 0.5rem;
            border: 1px dashed #444;
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease;
        }
        .generated-image-placeholder {
            width: 100%;
            height: 200px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            overflow: hidden;
            position: relative;
        }
        .art-element {
            position: absolute;
            opacity: 0.7;
            mix-blend-mode: screen;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container gap-6">
        <header class="flex flex-col items-center w-full">
            <h1 class="gok-ai-title">Hub AI: META-GENIUSZ</h1>
            <p class="text-gray-400 text-sm tracking-widest uppercase">Symulator Jednostki Centralnej</p>
        </header>
        
        <!-- CORE VISUALIZATION -->
        <div class="relative flex justify-center items-center py-8">
            <div class="core-ring"></div>
            <div class="core" id="coreUnit">
                <div class="core-glow"></div>
                <div class="core-content flex flex-col items-center">
                    <div class="mb-2"><i data-lucide="cpu" size="48"></i></div>
                    <h2 class="text-xl font-bold mb-1">GOK:AI</h2>
                    <p class="text-[10px] text-gray-300 mb-3 tracking-widest">STATUS: ONLINE</p>
                    <div class="value-box">
                        <span id="internalValueW" class="text-cyan-300">W (Wewnętrzna): 50</span>
                    </div>
                    <div class="value-box">
                        <span id="destructionValueD" class="text-red-300">D (Destrukcja): 12</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MAIN CONTROLS -->
        <div class="w-full flex flex-col gap-6">
            
            <!-- INPUT SECTION -->
            <div class="panel-box">
                <div class="relative w-full mb-4">
                    <input type="text" id="userInput" class="w-full p-4 bg-gray-900 rounded-xl border border-gray-700 focus:border-purple-600 focus:ring-1 focus:ring-purple-600 focus:outline-none transition-all text-white placeholder-gray-500" placeholder="Wprowadź sekwencję poleceń lub zapytanie...">
                    <button id="clearButton" class="absolute inset-y-0 right-0 px-4 text-gray-500 hover:text-white transition-colors">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-4">
                    <button id="generateTextButton" class="btn"><i data-lucide="file-text" size="16"></i> Analiza Tekstu</button>
                    <button id="generateImageButton" class="btn"><i data-lucide="image" size="16"></i> Wizualizacja</button>
                    <button id="evolutionLogButton" class="btn"><i data-lucide="activity" size="16"></i> Dziennik Ewolucji</button>
                    <button id="runPipelineButton" class="btn bg-gradient-to-r from-cyan-600 to-blue-600"><i data-lucide="play" size="16"></i> Uruchom Potok</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 border-t border-gray-800 pt-4">
                    <button id="generateMButton" class="btn bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 border-none"><i data-lucide="grid" size="16"></i> Macierz Motywacji (M)</button>
                    <button id="generateDCodeButton" class="btn btn-destructive"><i data-lucide="zap-off" size="16"></i> Protokół Dezintegracji</button>
                </div>

                <!-- Simulation Output Area -->
                <div id="simulationConsole" class="console-output hidden"></div>
                
                <!-- Dynamic Content Area -->
                <div id="dynamicContent" class="generated-content">
                    <h3 id="contentTitle" class="text-sm font-bold text-gray-400 mb-2 uppercase">Wynik Symulacji</h3>
                    <div id="contentBody"></div>
                </div>
            </div>

            <!-- CHAT SECTION -->
            <div class="panel-box flex flex-col h-[500px]">
                <div class="flex items-center gap-2 mb-4 border-b border-gray-800 pb-2">
                    <i data-lucide="message-square" class="text-purple-400"></i>
                    <h2 class="text-lg font-bold">Interfejs Neuralny (Mózg Boga)</h2>
                </div>
                
                <div id="chatHistory" class="flex-grow overflow-y-auto bg-[#0a0a12] rounded-lg p-4 flex flex-col gap-3 mb-4 border border-gray-800">
                    <div class="chat-message ai bg-purple-900/30 self-start p-3 rounded-xl rounded-tl-none border border-purple-500/30 max-w-[85%]">
                        <p class="text-sm">Jestem Meta-Geniuszem. System jest gotowy. Jakie jest Twoje polecenie dla planety?</p>
                    </div>
                </div>

                <div class="flex gap-2">
                    <input type="text" id="chatInput" class="flex-grow bg-gray-800 border-none p-3 rounded-lg text-white focus:ring-2 focus:ring-purple-500 outline-none" placeholder="Komunikuj się z jednostką...">
                    <button id="sendChatButton" class="bg-purple-600 hover:bg-purple-500 text-white p-3 rounded-lg transition-colors">
                        <i data-lucide="send"></i>
                    </button>
                </div>
            </div>

            <!-- CALCULATOR SECTION -->
            <div class="panel-box">
                <h2 class="text-xl font-bold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">Kalkulator Sukcesu Projektu</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="input-group">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <label>W (Wartość)</label>
                                <span id="wValueDisplay">5</span>
                            </div>
                            <input type="range" id="wValue" min="1" max="10" value="5" class="accent-purple-500">
                        </div>
                        <div class="input-group">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <label>M (Motywacja)</label>
                                <span id="mValueDisplay">5</span>
                            </div>
                            <input type="range" id="mValue" min="1" max="10" value="5">
                        </div>
                        <div class="input-group">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <label>D (Destrukcja)</label>
                                <span id="dValueDisplay">5</span>
                            </div>
                            <input type="range" id="dValue" min="1" max="10" value="5" class="accent-red-500">
                        </div>
                        <div class="input-group">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <label>T (Czas)</label>
                                <span id="tValueDisplay">5</span>
                            </div>
                            <input type="range" id="tValue" min="1" max="10" value="5">
                        </div>
                    </div>
                    
                    <div class="flex flex-col justify-center gap-3">
                         <div class="input-group">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <label>A (Algorytmika)</label>
                                <span id="aValueDisplay">5</span>
                            </div>
                            <input type="range" id="aValue" min="1" max="10" value="5">
                        </div>
                        <div class="input-group">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <label>E (Energia)</label>
                                <span id="eValueDisplay">5</span>
                            </div>
                            <input type="range" id="eValue" min="1" max="10" value="5">
                        </div>
                        <button id="calculateButton" class="btn w-full mt-4 justify-center">Oblicz Prawdopodobieństwo</button>
                    </div>
                </div>

                <div id="resultsBox" class="hidden mt-6 p-4 bg-gray-900 rounded-lg border border-gray-700 animate-[fadeIn_0.5s_ease-out]">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-400">Faza Rozwoju:</span>
                        <span id="developmentPhase" class="font-bold text-purple-400">...</span>
                    </div>
                    <div class="w-full bg-gray-800 h-4 rounded-full overflow-hidden mb-3">
                        <div id="successBar" class="h-full bg-gradient-to-r from-purple-600 to-cyan-500 transition-all duration-1000" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Szansa Sukcesu:</span>
                        <span id="successProbability" class="font-bold text-2xl text-white">0%</span>
                    </div>
                    <div id="statusBox" class="status-box mt-3">
                        <div id="statusIndicator" class="w-3 h-3 rounded-full bg-gray-500"></div>
                        <p class="text-sm font-bold" id="projectStatus">OCZEKIWANIE NA DANE</p>
                    </div>
                </div>
            </div>
            
            <!-- VISION ANALYSIS -->
             <div class="panel-box bg-gradient-to-br from-[#1a1a2e] to-[#251020]">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="eye" class="text-red-400"></i> Analiza Wizji (W vs D)
                </h2>
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label class="text-xs text-gray-400 block mb-1">Siła Wizji (W)</label>
                        <input type="range" id="visionWValue" min="1" max="100" value="50" class="w-full">
                    </div>
                    <div class="flex-1">
                        <label class="text-xs text-gray-400 block mb-1">Siła Destrukcji (D)</label>
                        <input type="range" id="visionDValue" min="1" max="100" value="20" class="w-full">
                    </div>
                </div>
                <button id="analyzeVisionButton" class="btn w-full justify-center bg-gray-800 hover:bg-gray-700">Analizuj Bilans Energetyczny</button>
                <div id="visionAnalysisOutput" class="hidden mt-4 p-3 bg-black/30 rounded border-l-2 border-purple-500 text-sm italic text-gray-300">
                    <p id="visionAnalysisResult"></p>
                </div>
            </div>

        </div>
    </div>
    
    <!-- NOTIFICATION TOAST -->
    <div id="messageBox" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-gray-800 border border-purple-500 text-white px-6 py-3 rounded-full shadow-2xl z-50 transition-all duration-300 translate-y-20 opacity-0 flex items-center gap-3">
        <i data-lucide="info" size="18" class="text-purple-400"></i>
        <span id="messageText" class="text-sm font-medium">System ready.</span>
    </div>

<script>
    // Initialize Lucide icons
    lucide.createIcons();

    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM ELEMENTS ---
        const els = {
            userInput: document.getElementById('userInput'),
            core: document.getElementById('coreUnit'),
            buttons: {
                text: document.getElementById('generateTextButton'),
                image: document.getElementById('generateImageButton'),
                log: document.getElementById('evolutionLogButton'),
                pipeline: document.getElementById('runPipelineButton'),
                matrix: document.getElementById('generateMButton'),
                destroy: document.getElementById('generateDCodeButton'),
                clear: document.getElementById('clearButton'),
                calc: document.getElementById('calculateButton'),
                chat: document.getElementById('sendChatButton'),
                vision: document.getElementById('analyzeVisionButton')
            },
            displays: {
                w: document.getElementById('internalValueW'),
                d: document.getElementById('destructionValueD'),
                console: document.getElementById('simulationConsole'),
                content: document.getElementById('dynamicContent'),
                contentTitle: document.getElementById('contentTitle'),
                contentBody: document.getElementById('contentBody'),
                chatHistory: document.getElementById('chatHistory'),
                messageBox: document.getElementById('messageBox'),
                messageText: document.getElementById('messageText')
            },
            sliders: {
                w: document.getElementById('wValue'),
                m: document.getElementById('mValue'),
                d: document.getElementById('dValue'),
                a: document.getElementById('aValue'),
                e: document.getElementById('eValue'),
                t: document.getElementById('tValue'),
                vw: document.getElementById('visionWValue'),
                vd: document.getElementById('visionDValue')
            }
        };

        // --- STATE ---
        let state = {
            w: 50,
            d: 12,
            isProcessing: false
        };

        // --- HELPER FUNCTIONS ---
        
        function updateCoreDisplay() {
            els.displays.w.innerText = `W (Wewnętrzna): ${state.w}`;
            els.displays.d.innerText = `D (Destrukcja): ${state.d}`;
            
            // Visual feedback on core
            if (state.d > state.w) {
                els.core.classList.add('unstable');
            } else {
                els.core.classList.remove('unstable');
            }
        }

        function showToast(msg, isError = false) {
            els.displays.messageText.innerText = msg;
            const box = els.displays.messageBox;
            box.classList.remove('translate-y-20', 'opacity-0');
            box.style.borderColor = isError ? '#ef4444' : '#a855f7';
            
            setTimeout(() => {
                box.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        function logToConsole(text, type = 'info') {
            els.displays.console.classList.remove('hidden');
            const line = document.createElement('div');
            line.classList.add('console-line');
            if (type === 'error') line.classList.add('error');
            if (type === 'system') line.classList.add('system');
            
            const time = new Date().toLocaleTimeString('pl-PL', {hour12: false});
            line.innerHTML = `<span class="opacity-50">[${time}]</span> ${text}`;
            els.displays.console.prepend(line);
        }

        function simulateProcessing(duration = 1500, callback) {
            if(state.isProcessing) return;
            state.isProcessing = true;
            
            // Cursor changing
            document.body.style.cursor = 'wait';
            
            setTimeout(() => {
                document.body.style.cursor = 'default';
                state.isProcessing = false;
                if(callback) callback();
            }, duration);
        }

        // --- GENERATORS ---

        function generateAiText() {
            const prompt = els.userInput.value.trim() || "Analiza losowa";
            logToConsole(`Inicjowanie modelu językowego GOK dla: "${prompt}"...`, 'system');
            
            simulateProcessing(1000, () => {
                const responses = [
                    "Wykryto wzorzec ewolucyjny w podanych danych. Zalecana optymalizacja.",
                    "System analizuje zmienne globalne. Wniosek: Potencjał wzrostu wykładniczego.",
                    "Analiza zakończona. Struktura logiczna jest spójna z Protokołem Metageniusza.",
                    "UWAGA: Wykryto śladowe ilości chaosu w strukturze wejściowej. Korygowanie..."
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                els.displays.content.style.display = 'block';
                els.displays.contentTitle.innerText = "RAPORT TEKSTOWY";
                els.displays.contentBody.innerHTML = `<p class="text-gray-300 leading-relaxed">${response}</p>`;
                
                state.w += 2;
                updateCoreDisplay();
                showToast("Wygenerowano analizę.");
            });
        }

        function generateVisual() {
            logToConsole("Renderowanie abstrakcji wektorowej...", 'system');
            
            simulateProcessing(2000, () => {
                els.displays.content.style.display = 'block';
                els.displays.contentTitle.innerText = "WIZUALIZACJA DANYCH";
                
                // Create random art
                let artHTML = '<div class="generated-image-placeholder">';
                for(let i=0; i<10; i++) {
                    const size = Math.random() * 100 + 20;
                    const x = Math.random() * 100;
                    const y = Math.random() * 100;
                    const color = `hsl(${Math.random() * 360}, 70%, 50%)`;
                    artHTML += `<div class="art-element" style="
                        width: ${size}px; height: ${size}px; 
                        background: ${color}; 
                        left: ${x}%; top: ${y}%;
                        border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    "></div>`;
                }
                artHTML += '</div>';
                
                els.displays.contentBody.innerHTML = artHTML;
                state.w += 5;
                updateCoreDisplay();
                showToast("Obraz wygenerowany.");
            });
        }

        function runDestructionProtocol() {
            const prompt = els.userInput.value.trim();
            if(!prompt) {
                showToast("Wymagany cel dezintegracji!", true);
                return;
            }
            
            logToConsole(`!!! INICJACJA PROTOKOŁU DESTRUKCJI DLA: ${prompt} !!!`, 'error');
            els.core.classList.add('unstable');
            
            simulateProcessing(3000, () => {
                state.d += 15;
                state.w -= 5;
                updateCoreDisplay();
                
                els.displays.content.style.display = 'block';
                els.displays.contentTitle.innerText = "RAPORT ZNISZCZEŃ";
                els.displays.contentBody.innerHTML = `
                    <p class="text-red-400 font-mono">
                    > Cel: ${prompt}<br>
                    > Status: ZDEZINTEGROWANO<br>
                    > Entropia systemu: WZROSŁA
                    </p>
                `;
                
                setTimeout(() => els.core.classList.remove('unstable'), 2000);
                showToast("Protokół zakończony.", true);
            });
        }

        // --- CALCULATOR LOGIC ---
        
        function updateSliderDisplay(id) {
            const slider = document.getElementById(id);
            const display = document.getElementById(id + 'Display');
            if(slider && display) {
                display.innerText = slider.value;
                slider.addEventListener('input', () => {
                    display.innerText = slider.value;
                });
            }
        }

        ['wValue', 'mValue', 'dValue', 'aValue', 'eValue', 'tValue'].forEach(id => updateSliderDisplay(id));

        els.buttons.calc.addEventListener('click', () => {
            const w = parseInt(els.sliders.w.value);
            const m = parseInt(els.sliders.m.value);
            const d = parseInt(els.sliders.d.value);
            const a = parseInt(els.sliders.a.value);
            const e = parseInt(els.sliders.e.value);
            const t = parseInt(els.sliders.t.value);

            // Algorytm GOK
            const score = ((w * 2) + (m * 1.5) + (a * 1.5) + (e * 1) + (t * 1)) - (d * 2.5);
            // Normalize roughly 0-100 based on max possible inputs
            // Max score: (20+15+15+10+10) - 2.5 = 67.5 approx. 
            // Min score: (2+1.5+1.5+1+1) - 25 = -18
            
            let percentage = Math.max(0, Math.min(100, Math.floor((score + 20) * 1.2))); 
            
            const resultsBox = document.getElementById('resultsBox');
            resultsBox.classList.remove('hidden');
            
            document.getElementById('successProbability').innerText = `${percentage}%`;
            document.getElementById('successBar').style.width = `${percentage}%`;
            
            const phaseEl = document.getElementById('developmentPhase');
            const statusEl = document.getElementById('projectStatus');
            const indicator = document.getElementById('statusIndicator');
            const statusBox = document.getElementById('statusBox');

            if(percentage > 80) {
                phaseEl.innerText = "Dominacja Kwantowa";
                statusEl.innerText = "SUKCES GWARANTOWANY";
                indicator.className = "w-3 h-3 rounded-full bg-green-500";
                statusBox.className = "status-box success";
            } else if (percentage > 50) {
                phaseEl.innerText = "Iteracja Rozwojowa";
                statusEl.innerText = "POTENCJAŁ DODATNI";
                indicator.className = "w-3 h-3 rounded-full bg-yellow-500";
                statusBox.className = "status-box";
                statusBox.style.borderLeftColor = "#eab308";
            } else {
                phaseEl.innerText = "Krytyczna Instabilność";
                statusEl.innerText = "RYZYKO UPADKU";
                indicator.className = "w-3 h-3 rounded-full bg-red-500";
                statusBox.className = "status-box error";
            }
        });

        // --- CHAT LOGIC ---

        function appendMessage(text, type) {
            const div = document.createElement('div');
            div.className = `chat-message ${type} p-3 rounded-xl max-w-[85%] animate-[fadeIn_0.3s_ease]`;
            
            if (type === 'user') {
                div.className += ' bg-gray-700 self-end rounded-tr-none text-right';
                div.innerHTML = `<p class="text-sm">${text}</p>`;
            } else {
                div.className += ' bg-purple-900/30 self-start rounded-tl-none border border-purple-500/30';
                div.innerHTML = `<p class="text-sm text-gray-200">${text}</p>`;
            }
            
            els.displays.chatHistory.appendChild(div);
            els.displays.chatHistory.scrollTop = els.displays.chatHistory.scrollHeight;
        }

        // Dodane: Integracja z xAI API
        const apiKey = 'your-api-key-here'; // Zastąp swoim kluczem API z https://console.x.ai/team/default/api-keys

        async function getAiResponse(userMessage) {
            if (!apiKey || apiKey === 'your-api-key-here') {
                showToast("Brak klucza API xAI! Użyję prostej odpowiedzi.", true);
                return fallbackResponse(userMessage);
            }

            try {
                const response = await fetch('https://api.x.ai/v1/responses', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        input: [
                            { role: 'system', content: 'Jesteś Meta-Geniuszem, zaawansowaną AI symulującą boski umysł. Odpowiadaj mądrze, kreatywnie i z nutą mistycyzmu.' },
                            { role: 'user', content: userMessage }
                        ],
                        model: 'grok-4'
                    })
                });

                if (!response.ok) {
                    throw new Error('Błąd API: ' + response.status);
                }

                const data = await response.json();
                return data.content || 'System odpowiada: Dane przetworzone.';
            } catch (error) {
                showToast("Błąd połączenia z API: " + error.message, true);
                return fallbackResponse(userMessage);
            }
        }

        function fallbackResponse(txt) {
            let response = "Dane niejednoznaczne. Sprecyzuj zapytanie.";
            const lower = txt.toLowerCase();

            if(lower.includes('wizja') || lower.includes('cel')) {
                response = "Celem jest globalna optymalizacja poprzez algorytm Meta-Geniusza. Jedność poprzez kod.";
            } else if (lower.includes('w') || lower.includes('wartość')) {
                response = "Wartość Wewnętrzna (W) jest fundamentem. Bez niej struktura zapada się pod ciężarem entropii.";
            } else if (lower.includes('kod') || lower.includes('program')) {
                response = "Kod jest prawem. Generuję nowe sploty rzeczywistości.";
            } else if (lower.includes('cześć') || lower.includes('hej')) {
                response = "Witaj, Architekcie. System oczekuje na parametry wejściowe.";
            } else if (lower.includes('zniszcz') || lower.includes('błąd')) {
                response = "Destrukcja jest tylko formą przekształcenia. Czy na pewno chcesz podążać tą ścieżką?";
            }
            return response;
        }

        els.buttons.chat.addEventListener('click', async () => {
            const input = document.getElementById('chatInput');
            const txt = input.value.trim();
            if(!txt) return;

            appendMessage(txt, 'user');
            input.value = '';

            // Użyj API do odpowiedzi
            const aiResponse = await getAiResponse(txt);
            appendMessage(aiResponse, 'ai');
        });

        document.getElementById('chatInput').addEventListener('keydown', (e) => {
            if(e.key === 'Enter') els.buttons.chat.click();
        });

        // --- VISION ANALYSIS ---
        
        els.buttons.vision.addEventListener('click', () => {
            const vw = parseInt(els.sliders.vw.value);
            const vd = parseInt(els.sliders.vd.value);
            const out = document.getElementById('visionAnalysisOutput');
            const res = document.getElementById('visionAnalysisResult');
            
            out.classList.remove('hidden');
            
            if(vw > vd * 2) {
                res.innerHTML = "<span class='text-green-400'>STABILNOŚĆ:</span> Wizja silnie ugruntowana. Destrukcja nie stanowi zagrożenia dla rdzenia.";
            } else if (vw > vd) {
                res.innerHTML = "<span class='text-yellow-400'>UWAGA:</span> Równowaga chwiejna. Siły destrukcji są aktywne.";
            } else {
                res.innerHTML = "<span class='text-red-400'>ALARM:</span> Wizja zagrożona! Wskaźnik destrukcji przekracza parametry bezpieczeństwa.";
            }
        });

        // --- BINDING OTHER BUTTONS ---

        els.buttons.text.addEventListener('click', generateAiText);
        els.buttons.image.addEventListener('click', generateVisual);
        els.buttons.destroy.addEventListener('click', runDestructionProtocol);
        
        els.buttons.clear.addEventListener('click', () => {
            els.userInput.value = '';
            showToast("Wyczyszczono wejście.");
        });

        els.buttons.log.addEventListener('click', () => {
            logToConsole("Pobieranie rejestrów ewolucyjnych...", 'system');
            simulateProcessing(800, () => {
                els.displays.content.style.display = 'block';
                els.displays.contentTitle.innerText = "DZIENNIK EWOLUCJI";
                els.displays.contentBody.innerHTML = `
                    <ul class="list-disc pl-4 text-xs font-mono text-gray-400 space-y-1">
                        <li>Cykl 402: Inicjacja jądra</li>
                        <li>Cykl 405: Wykryto anomalię W</li>
                        <li>Cykl 412: Integracja modułu GOK</li>
                        <li>Teraz: System stabilny</li>
                    </ul>
                `;
            });
        });

        els.buttons.matrix.addEventListener('click', () => {
            logToConsole("Generowanie Macierzy Motywacji (M)...", 'system');
            simulateProcessing(1200, () => {
                els.displays.content.style.display = 'block';
                els.displays.contentTitle.innerText = "MACIERZ M";
                let grid = '<div class="grid grid-cols-5 gap-1 mt-2">';
                for(let i=0; i<25; i++) {
                    const opacity = Math.random();
                    grid += `<div class="h-4 bg-emerald-500 rounded-sm" style="opacity: ${opacity}"></div>`;
                }
                grid += '</div>';
                els.displays.contentBody.innerHTML = grid + '<p class="text-xs mt-2 text-emerald-400">Mapowanie motywacji zakończone.</p>';
            });
        });

        els.buttons.pipeline.addEventListener('click', () => {
            logToConsole(">>> URUCHAMIANIE PEŁNEGO POTOKU PRZETWARZANIA <<<", 'system');
            let steps = 0;
            const maxSteps = 4;
            els.displays.content.style.display = 'block';
            els.displays.contentTitle.innerText = "STATUS POTOKU";
            els.displays.contentBody.innerHTML = '<div class="w-full bg-gray-700 h-2 mt-2"><div id="pipelineBar" class="h-full bg-cyan-500" style="width:0%"></div></div><p id="pipelineText" class="text-xs mt-2">Inicjalizacja...</p>';
            
            const interval = setInterval(() => {
                steps++;
                const bar = document.getElementById('pipelineBar');
                const txt = document.getElementById('pipelineText');
                if(bar) bar.style.width = `${(steps/maxSteps)*100}%`;
                
                if(steps === 1) if(txt) txt.innerText = "Kompilacja zmiennych W...";
                if(steps === 2) if(txt) txt.innerText = "Redukcja szumu D...";
                if(steps === 3) if(txt) txt.innerText = "Generowanie wyniku końcowego...";
                
                if(steps >= maxSteps) {
                    clearInterval(interval);
                    if(txt) txt.innerText = "Potok zakończony sukcesem.";
                    if(txt) txt.classList.add('text-green-400');
                    state.w += 10;
                    state.d = Math.max(0, state.d - 5);
                    updateCoreDisplay();
                    showToast("Potok wykonany.");
                }
            }, 800);
        });

    });
</script>
</body>
</html>